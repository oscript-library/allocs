# allocs

[![Release](https://img.shields.io/github/release/Stivo182/oscript-allocs.svg)](https://github.com/Stivo182/oscript-allocs/releases)
[![Тестирование](https://github.com/Stivo182/oscript-allocs/actions/workflows/test.yml/badge.svg)](https://github.com/Stivo182/oscript-allocs/actions/workflows/test.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

`allocs` — Инструмент для мониторинга потребления управляемой памяти в скриптах на платформе OneScript.

## Установка <a name="installation"></a>

```bsl
opm install allocs
```

## Использование <a name="usage"></a>

```bsl
#Использовать allocs

МониторПамяти = Новый МониторПамяти();
```

| Метод | Описание |
|-------------------------|----------|
| `Начать()` / `Start()` | Запускает замер памяти |
| `Завершить()` / `Stop()` | Возвращает количество байт, выделенных с момента вызова `Начать()` |
| `РазмерКучи()` / `HeapSize()` | Текущий размер управляемой кучи |
| `ВсегоВыделеноБайт()` / `TotalAllocatedBytes()` | Общее количество байт, выделенных управляемой памятью в процессе работы приложения с момента его старта |

> [!IMPORTANT]
> Не используйте метод `РазмерКучи()` для измерения дельты выделенной памяти (аллокаций).

### Пример измерения выделенной памяти

```bsl
#Использовать allocs

Монитор = Новый МониторПамяти();
Монитор.Начать();

// Здесь код, потребление памяти которого нужно измерить
Массив = Новый Массив;
Для і = 1 По 100000 Цикл
    Массив.Добавить("Длинная строка для теста памяти");
КонецЦикла;

ВыделеноБайт = Монитор.Завершить();

Сообщить("Выделено примерно: " + Формат(ВыделеноБайт / 1024 / 1024, "ЧДЦ=2") + " МБ");
```

## Совместимость <a name="compatibility"></a>

Инструмент протестирован и поддерживается на следующих платформах и версиях OneScript:

| ОС | OneScript 1.9 | OneScript 2.0 |
| --- | --- | --- |
| **Windows** | ✅ | ✅ |
| **Linux** | ✅ | ✅ |
| **MacOS** | ✅ | ✅ |